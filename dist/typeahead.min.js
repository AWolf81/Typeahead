/*! typeahead 2015-09-13 */
angular.module("pdTypeAhead",["pdMousetrap"]).directive("typeAhead",["$document","$compile","$filter",function(a,b,c){return{restrict:"A",scope:{cinfo:"=datalist"},replace:!1,controllerAs:"typeAheadCtrl",controller:["$scope","$attrs","pdTypeAheadSelectService",function(a,b,d){var e=this,f=function(a){return e.results?e.results.indexOf(a):0},g=function(){return e.results.length};this.hide=function(){a.typeAheadVisible(!1)},this.updateSelection=function(b){a.selectedNameIndex=b,angular.forEach(e.results,function(a,c){a.selected=!1,c==b&&(a.selected=!0,document.getElementsByClassName("active").length&&(document.getElementsByClassName("dropdown")[0].scrollTop=document.getElementsByClassName("active")[0].offsetTop-248))})},a.sterm="",a.visible=!0,a.typeAheadVisible=function(b){a.visible=a.sterm.length>0&&b},a.$watch(function(){return e.results},function(b){var c=b.length;c&&(d.setMax(c),e.updateSelection(d.getSelected()),c>1&&a.typeAheadVisible(!0))}),a.$on("pd.typeahead:enter",function(b,c){a.typeAheadVisible(!1)}),a.$on("pd.typeahead:backspace",function(b,c){a.sterm.length>1?a.typeAheadVisible(!0):a.typeAheadVisible(!1)}),a.$on("pd.typeahead:updatedIndex",function(b,c){e.updateSelection(c),a.$apply()}),a.$on("pd.typeahead:close",function(){e.hide(),a.$apply()}),a.$on("pd.typeahead:applySelection",function(b,c){e.results[c]&&(a.updateSearchTerm(e.results[c]),a.$apply())}),a.updateSearchTerm=function(b){a.sterm=b.value,a.typeAheadVisible(!1)},a.close=function(){e.hide()},a.filterData=function(b){e.results=c("filter")(a.cinfo,b),e.results=c("limitTo")(e.results||[],100),d.setSelected(f(b)),d.setMax(g()),a.selectedNameIndex=d.getSelected()},a.filterData("")}],link:function(c,d,e){d[0].focus(),d.attr("pd-mousetrap",""),d.removeAttr("type-ahead"),d.removeAttr("data-type-ahead"),a[0].getElementById("idSearch").focus(),b(d)(c)},templateUrl:"src/components/typeahead/typeahead.tmpl"}}]),angular.module("pdTypeAhead").factory("pdTypeAheadService",["$http","$q","DATA_SERVICE",function(a,b,c){var d={},e=b.defer();return d.getData=function(){return a.get(c).success(function(a){var b=a.map(function(a,b){return{selected:!1,value:a}});e.resolve(b)}).error(function(a){e.reject(a)}),e.promise},d}]).factory("pdTypeAheadSelectService",["$rootScope",function(a){var b=0,c=0;return{setSelected:function(a){b=a},setMax:function(a){c=a},getSelected:function(){return b},moveUp:function(){b>0&&b--,a.$broadcast("pd.typeahead:updatedIndex",b)},moveDown:function(){c-1>b&&b++,a.$broadcast("pd.typeahead:updatedIndex",b)},applySelection:function(){a.$broadcast("pd.typeahead:applySelection",b)}}}]),angular.module("typeahead.tpls",[]).run(["$templateCache",function(a){}]);